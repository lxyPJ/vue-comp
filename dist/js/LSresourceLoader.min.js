var scriptQueue=[],LSresourceLoader=function(e){var t=function(e){var t=this;t.url=e.url,t.no=e.no,t.ver=e.ver,t.onload=e.onload,t.quantity=e.quantity;var o={no:t.no,ver:t.ver,key:null,text:null,onload:t.onload,done:!1};scriptQueue[t.no]=o;var r=t.getScriptFromLS(t.url),n=localStorage.getItem("cache-js-"+t.no);if(null!==r&&"refresh"!==t.ver&&n===t.ver)o.key=t.url,o.text=r,t.injectScriptsInOrder(t);else if(null===r||"refresh"===t.ver||n!==t.ver){var l=null;try{l=new XMLHttpRequest}catch(e){l=new ActiveXObject("Microsoft.XMLHTTP")}l.open("GET",e.url,!0),l.send(null),l.onreadystatechange=function(){4==l.readyState&&(200==l.status?(console.log("获取脚本："+t.url),t.setScriptToLS(t.url,l.responseText,t.no,t.ver),o.key=t.url,o.text=l.responseText,t.injectScriptsInOrder(t)):console.log("出错了,Err："+l.status))}}};return t.prototype.getScriptFromLS=function(e){return window.localStorage?localStorage.getItem(e):null},t.prototype.setScriptToLS=function(e,t,o,r){window.localStorage&&(localStorage.setItem(e,t),localStorage.setItem("cache-js-"+o,r))},t.prototype.injectScriptsInOrder=function(e){for(var t=scriptQueue.length,o=0;o<t;o++){var r=scriptQueue[o];if(!r.done){if(null===r.text)break;e.injectScriptTagToDOM(r),o==quantity-1&&console.log("资源准备就绪")}}},t.prototype.injectScriptTagToDOM=function(e){var t=document.createElement("script");t.type="text/javascript",t.text=e.text,document.getElementsByTagName("body")[0].appendChild(t),e.onload&&e.onload(),e.done=!0,console.log(e.key+" 插入了DOM")},new t(e)};